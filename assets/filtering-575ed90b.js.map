{"version":3,"file":"filtering-575ed90b.js","sources":["../../src/scripts/lib/filters/filtering.js"],"sourcesContent":["import { qsa } from '@fluorescent/dom';\n\nconst filtering = container => {\n  const forms = qsa('[data-filter-form]', container);\n  let formData, searchParams;\n  setParams();\n\n  function setParams(form) {\n    if (!form) {\n      console.warn(\"filtering#setParams no form passed\")\n    }\n    form = form || forms[0];\n    formData = new FormData(form);\n    searchParams = new URLSearchParams(formData).toString();\n  }\n\n  /**\n   * Takes the updated form element and updates all other forms with the updated values\n   * @param {*} target\n   */\n  function syncForms(target) {\n    if (!target) return;\n\n    const targetInputs = qsa('[data-filter-item-input]', target);\n\n    targetInputs.forEach(targetInput => {\n      if (targetInput.type === 'checkbox' || targetInput.type === 'radio') {\n        const { valueEscaped } = targetInput.dataset;\n        const items = qsa(\n          `input[name='${targetInput.name}'][data-value-escaped='${valueEscaped}']`\n        );\n\n        items.forEach(input => {\n          input.checked = targetInput.checked;\n        });\n      } else {\n        const items = qsa(`input[name='${targetInput.name}']`);\n        items.forEach(input => {\n          input.value = targetInput.value;\n        });\n      }\n    });\n  }\n\n  /**\n   * When filters are removed, set the checked attribute to false\n   * for all filter inputs for that filter.\n   * Can accept multiple filters\n   * @param {Array} targets Array of inputs\n   */\n  function uncheckFilters(targets) {\n    if (!targets) return;\n\n    let selector;\n\n    targets.forEach(target => {\n      selector = !selector ? '' : `, ${selector}`;\n      const { name, valueEscaped } = target.dataset;\n      selector = `input[name='${name}'][data-value-escaped='${valueEscaped}']${selector}`;\n    });\n\n    const inputs = qsa(selector, container);\n\n    inputs.forEach(input => {\n      input.checked = false;\n    });\n  }\n\n  function clearRangeInputs() {\n    const rangeInputs = qsa('[data-range-input]', container);\n    rangeInputs.forEach(input => {\n      input.value = '';\n    });\n  }\n\n  function resetForms() {\n    forms.forEach(form => {\n      form.reset();\n    });\n  }\n\n  return {\n    getState() {\n      return {\n        url: searchParams,\n      };\n    },\n\n    filtersUpdated(target, cb) {\n      syncForms(target);\n      setParams(target);\n      return cb(this.getState());\n    },\n\n    removeFilters(target, cb) {\n      uncheckFilters(target);\n      setParams();\n      return cb(this.getState());\n    },\n\n    removeRange(cb) {\n      clearRangeInputs();\n      setParams();\n      return cb(this.getState());\n    },\n\n    clearAll(cb) {\n\n      searchParams = '';\n      resetForms();\n\n      return cb(this.getState());\n    },\n  };\n};\n\nexport default filtering;\n"],"names":["filtering","container","forms","qsa","formData","searchParams","setParams","form","console","warn","FormData","URLSearchParams","toString","syncForms","target","targetInputs","forEach","targetInput","type","valueEscaped","dataset","items","name","input","checked","value","uncheckFilters","targets","selector","inputs","clearRangeInputs","rangeInputs","resetForms","reset","getState","url","filtersUpdated","cb","removeFilters","removeRange","clearAll"],"mappings":"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"}