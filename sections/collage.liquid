{%- assign settings = section.settings -%}

<section
  class="collage {% if settings.enable_full_width %}full-width{% endif %}"
  data-section-id="{{ section.id }}"
  data-section-type="collage"
>
  <div class="collage__grid collage__grid--{{ section.blocks.size }}">
    {%- for block in section.blocks -%}
      {%- liquid
        assign desktop_image = block.settings.image
        assign mobile_image = block.settings.mobile_image
        assign focal_point = block.settings.focal_point | replace: "_", " " 
        assign focal_point_mobile = block.settings.focal_point_mobile | replace: "_", " "

      -%}
      <div class="collage__block collage__block--{{ forloop.index }} borders-nfw {% if mobile_image != blank %}collage__block--has-mobile-image{% endif %}" 
           style="--media-focal-point: {{ focal_point }}; --mobile-media-focal-point: {{ focal_point_mobile }};">

        {%- if desktop_image != blank -%}
          {% render 'image' with
            image: desktop_image,
            wrapper_class: 'collage__image-wrapper collage__image--desktop',
            disable_style: true,
            sizes: "(max-width: 640px) calc(100vw - 40px), calc(100vw - 80px)"
          %}
        {%- endif -%}

        {%- if mobile_image != blank -%}
          {% render 'image' with
            image: mobile_image
            wrapper_class: 'collage__image-wrapper collage__image--mobile',
            disable_style: true,
            sizes: "(max-width: 640px) calc(100vw - 40px), calc(100vw - 80px)"
          %}
        {%- endif -%}

        {% if block.settings.video_url != blank %}
          <video class="collage__block-video" autoplay playsinline loop muted src="{{ block.settings.video_url }}"></video>
        {% endif %}

        <div class="collage__block-overlay">
          {% render 'block-overlay' with
            block: block,

            meta: block.settings.meta,
            heading: block.settings.title,
            subheading: block.settings.subheading,
            link: block.settings.link,
            link_text: block.settings.link_text,

            alignment: block.settings.alignment,
            max_width_content: block.settings.max_width_subheading,

            opacity: block.settings.opacity_overlay,
            color_background: settings.color_overlay,
            color_background_button: settings.color_background_button,
            color_heading: settings.color_heading,
            color_subheading: settings.color_subheading,
            color_text_button: settings.color_text_button
          %}
        </div>
      </div>
    {%- endfor -%}
  </div>

</section>

{% schema %}
  {
    "name": "t:sections.collage.name",
    "class": "grid-section collage-section",
    "max_blocks": 5,
    "settings": [
      {
        "id": "color_overlay",
        "type": "color",
        "label": "t:sections.collage.settings.color_overlay.label",
        "default": "#000000"
      },
      {
        "id": "color_heading",
        "type": "color",
        "label": "t:sections.collage.settings.color_heading.label",
        "default": "#ffffff"
      },
      {
        "id": "color_subheading",
        "type": "color",
        "label": "t:sections.collage.settings.color_subheading.label",
        "default": "#b8b8b8"
      },
      {
        "id": "color_background_button",
        "type": "color",
        "label": "t:sections.collage.settings.color_background_button.label",
        "default": "#000000"
      },
      {
        "id": "color_text_button",
        "type": "color",
        "label": "t:sections.collage.settings.color_text_button.label",
        "default": "#ffffff"
      },
      {
        "id": "enable_full_width",
        "type": "checkbox",
        "label": "t:sections.collage.settings.enable_full_width.label",
        "info": "t:sections.collage.settings.enable_full_width.info",
        "default": false
      }
    ],
    "blocks": [
      {
        "type": "image",
        "name": "t:sections.collage.blocks.name",
        "settings": [
          {
            "id": "image",
            "type": "image_picker",
            "label": "t:sections.collage.blocks.settings.image.label"
          },
          {
            "id": "mobile_image",
            "type": "image_picker",
            "label": "t:sections.collage.blocks.settings.mobile_image.label"
          },
          {
            "id": "focal_point",
            "type": "select",
            "label": "t:shared.focal_point.label",
            "options": [
              { "label": "t:shared.focal_point.options.left_top", "value": "left_top" },
              { "label": "t:shared.focal_point.options.center_top", "value": "center_top" },
              { "label": "t:shared.focal_point.options.right_top", "value": "right_top" },
              { "label": "t:shared.focal_point.options.left_center", "value": "left_center" },
              { "label": "t:shared.focal_point.options.center_center", "value": "center_center" },
              { "label": "t:shared.focal_point.options.right_center", "value": "right_center" },
              { "label": "t:shared.focal_point.options.left_bottom", "value": "left_bottom" },
              { "label": "t:shared.focal_point.options.center_bottom", "value": "center_bottom" },
              { "label": "t:shared.focal_point.options.right_bottom", "value": "right_bottom" }
            ],
            "default": "center_center"
          },
          {
            "id": "focal_point_mobile",
            "type": "select",
            "label": "t:shared.focal_point.label_mobile",
            "options": [
              { "label": "t:shared.focal_point.options.left_top", "value": "left_top" },
              { "label": "t:shared.focal_point.options.center_top", "value": "center_top" },
              { "label": "t:shared.focal_point.options.right_top", "value": "right_top" },
              { "label": "t:shared.focal_point.options.left_center", "value": "left_center" },
              { "label": "t:shared.focal_point.options.center_center", "value": "center_center" },
              { "label": "t:shared.focal_point.options.right_center", "value": "right_center" },
              { "label": "t:shared.focal_point.options.left_bottom", "value": "left_bottom" },
              { "label": "t:shared.focal_point.options.center_bottom", "value": "center_bottom" },
              { "label": "t:shared.focal_point.options.right_bottom", "value": "right_bottom" }
            ],
            "default": "center_center"
          },
          {
            "type": "url",
            "id": "video_url",
            "label": "t:sections.collage.blocks.settings.video_url.label",
            "info": "Direct link to .mp4 video file. [Learn more here](https://fluorescent.co/help/ira/collage/#add-a-video-to-a-collage-section)."
          },
          {
            "id": "meta",
            "type": "text",
            "label": "t:sections.collage.blocks.settings.meta.label",
            "default": "Meta"
          },
          {
            "id": "title",
            "type": "text",
            "label": "t:sections.collage.blocks.settings.title.label",
            "default": "This is the Collage"
          },
          {
            "id": "subheading",
            "type": "richtext",
            "label": "t:sections.collage.blocks.settings.subheading.label",
            "default": "<p>Use this Section to promote a series of editorial images, or to divide space among a series of editorial images. Be careful not to add too much text.</p>"
          },
          {
            "id": "max_width_subheading",
            "type": "range",
            "label": "t:sections.collage.blocks.settings.max_width_subheading.label",
            "min": 12,
            "max": 46,
            "step": 2,
            "default": 28
          },
          {
            "id": "link_text",
            "type": "text",
            "label": "t:sections.collage.blocks.settings.link_text.label"
          },
          {
            "id": "link",
            "type": "url",
            "label": "t:sections.collage.blocks.settings.link.label"
          },
          {
            "id": "alignment",
            "type": "select",
            "label": "t:sections.collage.blocks.settings.alignment.label",
            "options": [
              { "label": "t:sections.collage.blocks.settings.alignment.options.left_top.label", "value": "left_top" },
              { "label": "t:sections.collage.blocks.settings.alignment.options.center_top.label", "value": "center_top" },
              { "label": "t:sections.collage.blocks.settings.alignment.options.right_top.label", "value": "right_top" },
              { "label": "t:sections.collage.blocks.settings.alignment.options.left_center.label", "value": "left_center" },
              { "label": "t:sections.collage.blocks.settings.alignment.options.center_center.label", "value": "center_center" },
              { "label": "t:sections.collage.blocks.settings.alignment.options.right_center.label", "value": "right_center" },
              { "label": "t:sections.collage.blocks.settings.alignment.options.left_bottom.label", "value": "left_bottom" },
              { "label": "t:sections.collage.blocks.settings.alignment.options.center_bottom.label", "value": "center_bottom" },
              { "label": "t:sections.collage.blocks.settings.alignment.options.right_bottom.label", "value": "right_bottom" },
              { "label": "t:sections.collage.blocks.settings.alignment.options.left_split.label", "value": "left_split" },
              { "label": "t:sections.collage.blocks.settings.alignment.options.center_split.label", "value": "center_split" },
              { "label": "t:sections.collage.blocks.settings.alignment.options.right_split.label", "value": "right_split" }
            ],
            "default": "left_center"
          },
          {
            "id": "opacity_overlay",
            "type": "range",
            "label": "t:sections.collage.blocks.settings.opacity_overlay.label",
            "min": 0,
            "max": 100,
            "step": 10,
            "default": 60,
            "unit": "%"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Collage",
        "category": "Image",
        "blocks": [
          {
            "type": "image",
            "settings": {
              "title": "This is the Collage",
              "subheading": "<p>Use this Section to promote a series of editorial images, or to divide space among a series of editorial images. Be careful not to add too much text.</p>",
              "link": "#",
              "link_text": "Shop the collection"
            }
          },
          {
            "type": "image",
            "settings": {
              "title": "This is the Collage",
              "subheading": "<p>Use this Section to promote a series of editorial images, or to divide space among a series of editorial images. Be careful not to add too much text.</p>",
              "link": "#",
              "link_text": "Shop the collection"
            }
          }
        ]
      }
    ]
  }
{% endschema %}

